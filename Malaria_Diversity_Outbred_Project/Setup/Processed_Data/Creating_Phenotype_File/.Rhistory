setwd("~/GitHub/Diversity-Outbred-Malaria-Project/Malaria_Diversity_Outbred_Project/Setup/Creating_Phenotype_File")
library(tidyverse)
library(readr)
Data <- read_csv("axiom8_RawData.csv")
Data$Sex <- "F"
#This converts columns we care about to numeric
id <- c("Temperature","Weight", "Accuri Count")
Data[id] = data.matrix(Data[id])
Day0 <- Data[Data$Day==0,]
Initial <- subset(Day0, select = c("Number", "Temperature", "Weight"))
names(Initial) <- c("Number", "Initial Temperature", "Initial Weight")
Datai <-  merge(Data,Initial)
axiom8_phenotypes <- read_csv("GitHub/Diversity-Outbred-Malaria-Project/Malaria_Diversity_Outbred_Project/Setup/Creating_Phenotype_File/axiom8_phenotypes.csv",)
axiom8_phenotypes <- read_csv("axiom8_phenotypes.csv",)
#This converts columns we care about to numeric
id <- c("Temperature","Weight", "Accuri Count")
Data[id] = data.matrix(Data[id])
Day0 <- Data[Data$Day==0,]
Initial <- subset(Day0, select = c("Number", "Temperature", "Weight"))
names(Initial) <- c("Number", "Initial Temperature", "Initial Weight")
Datai <-  merge(Data,Initial)
Dataic <- Datai %>%
# calculate percent weight relative to day 0
mutate(`Percent Bodyweight` = ((Datai$Weight) / (Datai$`Initial Weight`) * 100))  %>%
# calculate percent weight loss relative to day 0
mutate(`Percent Change in Weight` = (((Datai$Weight)-(Datai$`Initial Weight`)) / (Datai$`Initial Weight`)) * 100)%>%
# calculate weight loss relative to day 0
mutate(`Change in Weight` = (Datai$Weight)-(Datai$`Initial Weight`)) %>%
# calculate RBCs from raw accuri score
mutate(RBC = (Datai$`Accuri Count`) / 2000) %>%
# calculate delta temperature relative to day 0
mutate(`Change in Temperature` = ((Datai$Temperature) - (Datai$`Initial Temperature`))) %>%
# calculate parasite density
mutate(`Parasite Density` = Parasitemia * RBC)
Phenotypes %>%
subset(is.infinite(MinDeltaTemp) ==T)
Phenotypes <- Dataic %>%
subset(Day %in% c(0,5:15)) %>%
group_by(Number) %>%
summarize(White = as.numeric(`Coat Color`[Day==0]== "White"),
Black = as.numeric(`Coat Color`[Day==0]== "Black"),
Star = `Star?`[Day==0],
Lived = `Lived?`[Day==0],
MinDeltaTemp = min(`Change in Temperature`, na.rm = TRUE),
Day0Weight= `Initial Weight`[Day==0],
MinPercWeight = min(`Percent Change in Weight`, na.rm=TRUE),
MinDeltaWeight = min(`Change in Weight`, na.rm = TRUE),
Gainer = as.numeric(MinDeltaWeight==0),
MinRBC= min(RBC, na.rm=TRUE),
MaxPD = max(`Parasite Density`, na.rm=TRUE),
MaxParasitemia = max(Parasitemia, na.rm = TRUE),
Description = Description[1])
Phenotypes <- Dataic %>%
subset(Day %in% c(0,5:15)) %>%
group_by(Number) %>%
summarize(White = as.numeric(`Coat Color`[Day==0]== "White"),
Black = as.numeric(`Coat Color`[Day==0]== "Black"),
Star = `Star?`[Day==0],
Lived = `Lived?`[Day==0],
MinDeltaTemp = min(`Change in Temperature`, na.rm = TRUE),
Day0Weight= `Initial Weight`[Day==0],
MinPercWeight = min(`Percent Change in Weight`, na.rm=TRUE),
MinDeltaWeight = min(`Change in Weight`, na.rm = TRUE),
Gainer = as.numeric(MinDeltaWeight==0),
MinRBC= min(RBC, na.rm=TRUE),
MaxPD = max(`Parasite Density`, na.rm=TRUE),
MaxParasitemia = max(Parasitemia, na.rm = TRUE),
Description = Description[1])
# Changing experimental measurements from a mouse (415) that died before the experiment
Phenotypes[397,6:13] <- NA
# Notice how Minimum Change in temperature does not follow a normal distribution
qqnorm(Phenotypes$MinDeltaTemp)
qqline(Phenotypes$MinDeltaTemp)
# When we do a log transformation after taking the absolute value and adding one we get pretty close
logt <- log(abs(Phenotypes$MinDeltaTemp)+1)
qqnorm(logt)
qqline(logt)
# Just to compare methods I will also try yeo.johnson function from the VGAM function.
# install.packages("VGAM")
library(VGAM)
yj <-yeo.johnson(na.omit(Phenotypes$MinDeltaTemp), lambda = 2)
qqnorm(yj)
qqline(yj)
# The variance appears to be the same between log transforming the absolute value and adding one and doing the yeo.johnson transformation
var(Phenotypes$MinDeltaTemp,na.rm = T)
var(log(abs(Phenotypes$MinDeltaTemp)+1),na.rm = T)
var(yj,na.rm = T)
# With Minimum RBC distribution also isn't quite normal but is closer with a log transformation
qqnorm(na.omit(Phenotypes$MinRBC))
qqline(na.omit(Phenotypes$MinRBC))
qqnorm(log(na.omit(Phenotypes$MinRBC)))
qqline(log(na.omit(Phenotypes$MinRBC)))
Detectable <-Phenotypes %>%
subset(MaxPD !=0)
qqnorm(Phenotypes$MaxPD)
qqline(Phenotypes$MaxPD)
qqnorm(Detectable$MaxPD)
qqline(Detectable$MaxPD)
# First we will take out our NA Mouse (415) and add the transformation then add the mouse back in and arrange by mouse number
NoNADO <-Phenotypes[-397,] %>%
mutate(logMinDeltaTemp = log(abs(MinDeltaTemp)+1), ytMinDeltaTemp = yeo.johnson(MinDeltaTemp,lambda=2), logMinRBC = log(MinRBC), DetectableMaxPD = ifelse(MaxPD ==0,NA,MaxPD), DetectableParasitemia = ifelse(MaxParasitemia ==0, NA, MaxParasitemia))
# Removing Parental strains and mouse 503 because there isn't genotyping information with it
DO_Phenotypes <- bind_rows(NoNADO,Phenotypes[397,]) %>% filter(Description =="DO" & Number != 503)
# Adding placeholders for Mice c(175,178,187,194,199,204,216,220,228,244,343)
Placeholders <- tibble(Number = c(175,178,187,194,199,204,216,220,228,244,343))
Phenotypes_missing <-bind_rows(DO_Phenotypes, Placeholders)  %>% arrange(Number)
library(readr)
axiom8_NumberSamples <- read_csv("axiom8_NumberSamples.csv")
View(axiom8_NumberSamples)
# First we will take out our NA Mouse (415) and add the transformation then add the mouse back in and arrange by mouse number
NoNADO <-Phenotypes[-397,] %>%
mutate(logMinDeltaTemp = log(abs(MinDeltaTemp)+1), ytMinDeltaTemp = yeo.johnson(MinDeltaTemp,lambda=2), logMinRBC = log(MinRBC), DetectableMaxPD = ifelse(MaxPD ==0,NA,MaxPD), DetectableParasitemia = ifelse(MaxParasitemia ==0, NA, MaxParasitemia))
# Removing Parental strains and mouse 503 because there isn't genotyping information with it
DO_Phenotypes <- bind_rows(NoNADO,Phenotypes[397,]) %>% filter(Description =="DO" & Number != 503)
# Adding placeholders for Mice c(175,178,187,194,199,204,216,220,228,244,343)
Placeholders <- tibble(Number = c(175,178,187,194,199,204,216,220,228,244,343))
Phenotypes_missing <-bind_rows(DO_Phenotypes, Placeholders)  %>% arrange(Number)
axiom8_NumberSamples <- read_csv("axiom8_NumberSamples.csv")
Final_Phenotypes <-merge(Phenotypes_missing, axiom8_NumberSamples, by = "Number")
axiom8_phenotypes <-Final_Phenotypes %>%
select(SampleID, Number, White:DetectableParasitemia)
p <- file("axiom8_phenotypes.csv", "w")
writeLines("#phenotype data for axiom8",p)
writeLines("#nrow 501",p)
writeLines("#ncol 20",p)
write.csv(x = axiom8_phenotypes, file = p,row.names = F)
close(p)
library(readr)
axiom8_phenotypes <- read_csv("axiom8_phenotypes.csv",)
axiom8_phenotypes <-Final_Phenotypes %>%
select(SampleID, Number, White:DetectableParasitemia)
axiom8_phenotypes <- read_csv("axiom8_phenotypes.csv")
axiom8_phenotypes <-Final_Phenotypes %>%
select(SampleID, Number, White:DetectableParasitemia)
p <- file("axiom8_phenotypes.csv", "w")
writeLines("#phenotype data for axiom8",p)
writeLines("#nrow 501",p)
writeLines("#ncol 20",p)
write.csv(x = axiom8_phenotypes, file = p,row.names = F)
close(p)
axiom8_phenotypes <- read_csv("axiom8_phenotypes.csv")
axiom8_phenotypes <- read_csv("axiom8_phenotypes.csv", skip = 3)
axiom8_phenotypes1 <- read_csv("axiom8_phenotypes.csv", skip = 3)
p <- file("axiom8_phenotypes.csv", "w")
writeLines("#phenotype data for axiom8",p)
writeLines("#nrow 501",p)
writeLines("#ncol 20",p)
write.csv(x = axiom8_phenotypes, file = p,row.names = F)
close(p)
library(readr)
axiom8_phenotypes <- read_csv("axiom8_phenotypes.csv", skip = 3)
View(DO_Phenotypes)
# Removing Parental strains and mouse 503 because there isn't genotyping information with it
DO_Phenotypes <- bind_rows(NoNADO,Phenotypes[397,]) %>% filter(Description =="DO" & Number != 503)
# Adding placeholders for Mice c(175,178,187,194,199,204,216,220,228,244,343)
Placeholders <- tibble(Number = c(175,178,187,194,199,216,220,228,244,343))
Phenotypes_missing <-bind_rows(DO_Phenotypes, Placeholders)  %>% arrange(Number)
axiom8_NumberSamples <- read_csv("axiom8_NumberSamples.csv")
Final_Phenotypes <-merge(Phenotypes_missing, axiom8_NumberSamples, by = "Number")
axiom8_phenotypes <-Final_Phenotypes %>%
select(SampleID, Number, White:DetectableParasitemia)
p <- file("axiom8_phenotypes.csv", "w")
writeLines("#phenotype data for axiom8",p)
writeLines("#nrow 501",p)
writeLines("#ncol 20",p)
write.csv(x = axiom8_phenotypes, file = p,row.names = F)
close(p)
library(readr)
axiom8_phenotypes <- read_csv("axiom8_phenotypes.csv", skip = 3)
axiom7_pheno_20190827 <- read_csv("~/axiom7/axiom7_pheno_20190827.csv",
skip = 3)
axiom7_pheno_20190827$Number[!(axiom7_pheno_20190827$Number %in% axiom8_phenotypes$Number)]
# Removing Parental strains and mouse 503 because there isn't genotyping information with it
DO_Phenotypes <- bind_rows(NoNADO,Phenotypes[397,]) %>% filter(Description =="DO" & Number != 503)
# Adding placeholders for Mice c(175,178,187,194,199,203,216,220,228,244,343)
Placeholders <- tibble(Number = c(175,178,187,194,199,203,216,220,228,244,343))
Phenotypes_missing <-bind_rows(DO_Phenotypes, Placeholders)  %>% arrange(Number)
axiom8_NumberSamples <- read_csv("axiom8_NumberSamples.csv")
Final_Phenotypes <-merge(Phenotypes_missing, axiom8_NumberSamples, by = "Number")
axiom8_phenotypes <-Final_Phenotypes %>%
select(SampleID, Number, White:DetectableParasitemia)
p <- file("axiom8_phenotypes.csv", "w")
writeLines("#phenotype data for axiom8",p)
writeLines("#ncol 20",p)
writeLines("#nrow 501",p)
write.csv(x = axiom8_phenotypes, file = p,row.names = F)
close(p)
library(readr)
axiom8_phenotypes <- read_csv("axiom8_phenotypes.csv", skip = 3)
axiom7_pheno_20190827$Number[!(axiom7_pheno_20190827$Number %in% axiom8_phenotypes$Number)]
View(axiom8_phenotypes)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("biomaRt")
